set I; # items

set ST; # supply and transshipment nodes
set D; # demand nodes
set K := ST union D; # all nodes 
set E within {K, K}; # all edges

set DU; # dummy nodes
set KDU := K union DU; # all nodes + dummies
set EDU within {KDU,KDU}; # all edges + dummies

# param item_priority {I};
param transp_cost {E};
param supply_demand {KDU, I};
param node_capacity {K};

var X {EDU, I} >= 0 integer; # items to be transported

minimize Objectives: # item_priority[i] 
	(sum {(k,j) in E, i in I} transp_cost[k,j] * X[k,j,i]) + 
	10000*(sum {k in D, i in I} ((sum {(j,k) in E} X[j,k,i]) / -supply_demand[k,i]) ^ 2); # fairness
	
subject to Transportation_Balance {k in KDU, i in I}:
	sum {(k,j) in EDU} X[k,j,i] - sum {(j,k) in EDU} X[j,k,i] = supply_demand[k,i];

subject to Inbound_Capacity {k in K}:
	sum {(j,k) in E, i in I} X[j,k,i] <= node_capacity[k];
	
subject to Outbound_Capacity {k in K}:
	sum {(k,j) in E, i in I} X[k,j,i] <= node_capacity[k];
	
data;
set I := I1 I2 I3;
set ST := S1 S2 S3 S4 S5 S6 S7 S8 T11 T12 T13 T14 T15 T16 T17 T18 T19 T21 T22 T23 T24 T25 T26 T27 T31 T32 T33 T34 T35 T36 T37 T38 T39;
set D := D1 D2 D3 D4 D5 D6 D7;
set DU := dummy_sup dummy_dem;

set E := 
   (S1,T11) (S1,T12) (S1,T13) (S1,T14) (S1,T15) (S1,T16) (S1,T17) (S1,T18) (S1,T19) (S2,T11) (S2,T12) (S2,T13) (S2,T14) (S2,T15) (S2,T16) (S2,T17) (S2,T18) (S2,T19) (S3,T11) (S3,T12) (S3,T13) (S3,T14) (S3,T15) (S3,T16) (S3,T17) (S3,T18) (S3,T19) (S4,T11) (S4,T12) (S4,T13) (S4,T14) (S4,T15) (S4,T16) (S4,T17) (S4,T18) (S4,T19) (S5,T11) (S5,T12) (S5,T13) (S5,T14) (S5,T15) (S5,T16) (S5,T17) (S5,T18) (S5,T19) (S6,T11) (S6,T12) (S6,T13) (S6,T14) (S6,T15) (S6,T16) (S6,T17) (S6,T18) (S6,T19) (S7,T11) (S7,T12) (S7,T13) (S7,T14) (S7,T15) (S7,T16) (S7,T17) (S7,T18) (S7,T19) (S8,T11) (S8,T12) (S8,T13) (S8,T14) (S8,T15) (S8,T16) (S8,T17) (S8,T18) (S8,T19)
   (T11,T21) (T11,T22) (T11,T23) (T11,T24) (T11,T25) (T11,T26) (T11,T27) (T12,T21) (T12,T22) (T12,T23) (T12,T24) (T12,T25) (T12,T26) (T12,T27) (T13,T21) (T13,T22) (T13,T23) (T13,T24) (T13,T25) (T13,T26) (T13,T27) (T14,T21) (T14,T22) (T14,T23) (T14,T24) (T14,T25) (T14,T26) (T14,T27) (T15,T21) (T15,T22) (T15,T23) (T15,T24) (T15,T25) (T15,T26) (T15,T27) (T16,T21) (T16,T22) (T16,T23) (T16,T24) (T16,T25) (T16,T26) (T16,T27) (T17,T21) (T17,T22) (T17,T23) (T17,T24) (T17,T25) (T17,T26) (T17,T27) (T18,T21) (T18,T22) (T18,T23) (T18,T24) (T18,T25) (T18,T26) (T18,T27) (T19,T21) (T19,T22) (T19,T23) (T19,T24) (T19,T25) (T19,T26) (T19,T27) (T21,T31) (T21,T32) (T21,T33) (T21,T34) (T21,T35) (T21,T36) (T21,T37) (T21,T38) (T21,T39) (T22,T31) (T22,T32) (T22,T33) (T22,T34) (T22,T35) (T22,T36) (T22,T37) (T22,T38) (T22,T39) (T23,T31) (T23,T32) (T23,T33) (T23,T34) (T23,T35) (T23,T36) (T23,T37) (T23,T38) (T23,T39) (T24,T31) (T24,T32) (T24,T33) (T24,T34) (T24,T35) (T24,T36) (T24,T37) (T24,T38) (T24,T39) (T25,T31) (T25,T32) (T25,T33) (T25,T34) (T25,T35) (T25,T36) (T25,T37) (T25,T38) (T25,T39) (T26,T31) (T26,T32) (T26,T33) (T26,T34) (T26,T35) (T26,T36) (T26,T37) (T26,T38) (T26,T39) (T27,T31) (T27,T32) (T27,T33) (T27,T34) (T27,T35) (T27,T36) (T27,T37) (T27,T38) (T27,T39)
   (T31,D1) (T31,D2) (T31,D3) (T31,D4) (T31,D5) (T31,D6) (T31,D7) (T32,D1) (T32,D2) (T32,D3) (T32,D4) (T32,D5) (T32,D6) (T32,D7) (T33,D1) (T33,D2) (T33,D3) (T33,D4) (T33,D5) (T33,D6) (T33,D7) (T34,D1) (T34,D2) (T34,D3) (T34,D4) (T34,D5) (T34,D6) (T34,D7) (T35,D1) (T35,D2) (T35,D3) (T35,D4) (T35,D5) (T35,D6) (T35,D7) (T36,D1) (T36,D2) (T36,D3) (T36,D4) (T36,D5) (T36,D6) (T36,D7) (T37,D1) (T37,D2) (T37,D3) (T37,D4) (T37,D5) (T37,D6) (T37,D7) (T38,D1) (T38,D2) (T38,D3) (T38,D4) (T38,D5) (T38,D6) (T38,D7) (T39,D1) (T39,D2) (T39,D3) (T39,D4) (T39,D5) (T39,D6) (T39,D7)
;

set EDU := 
   (S1,T11) (S1,T12) (S1,T13) (S1,T14) (S1,T15) (S1,T16) (S1,T17) (S1,T18) (S1,T19) (S2,T11) (S2,T12) (S2,T13) (S2,T14) (S2,T15) (S2,T16) (S2,T17) (S2,T18) (S2,T19) (S3,T11) (S3,T12) (S3,T13) (S3,T14) (S3,T15) (S3,T16) (S3,T17) (S3,T18) (S3,T19) (S4,T11) (S4,T12) (S4,T13) (S4,T14) (S4,T15) (S4,T16) (S4,T17) (S4,T18) (S4,T19) (S5,T11) (S5,T12) (S5,T13) (S5,T14) (S5,T15) (S5,T16) (S5,T17) (S5,T18) (S5,T19) (S6,T11) (S6,T12) (S6,T13) (S6,T14) (S6,T15) (S6,T16) (S6,T17) (S6,T18) (S6,T19) (S7,T11) (S7,T12) (S7,T13) (S7,T14) (S7,T15) (S7,T16) (S7,T17) (S7,T18) (S7,T19) (S8,T11) (S8,T12) (S8,T13) (S8,T14) (S8,T15) (S8,T16) (S8,T17) (S8,T18) (S8,T19)
   (T11,T21) (T11,T22) (T11,T23) (T11,T24) (T11,T25) (T11,T26) (T11,T27) (T12,T21) (T12,T22) (T12,T23) (T12,T24) (T12,T25) (T12,T26) (T12,T27) (T13,T21) (T13,T22) (T13,T23) (T13,T24) (T13,T25) (T13,T26) (T13,T27) (T14,T21) (T14,T22) (T14,T23) (T14,T24) (T14,T25) (T14,T26) (T14,T27) (T15,T21) (T15,T22) (T15,T23) (T15,T24) (T15,T25) (T15,T26) (T15,T27) (T16,T21) (T16,T22) (T16,T23) (T16,T24) (T16,T25) (T16,T26) (T16,T27) (T17,T21) (T17,T22) (T17,T23) (T17,T24) (T17,T25) (T17,T26) (T17,T27) (T18,T21) (T18,T22) (T18,T23) (T18,T24) (T18,T25) (T18,T26) (T18,T27) (T19,T21) (T19,T22) (T19,T23) (T19,T24) (T19,T25) (T19,T26) (T19,T27) (T21,T31) (T21,T32) (T21,T33) (T21,T34) (T21,T35) (T21,T36) (T21,T37) (T21,T38) (T21,T39) (T22,T31) (T22,T32) (T22,T33) (T22,T34) (T22,T35) (T22,T36) (T22,T37) (T22,T38) (T22,T39) (T23,T31) (T23,T32) (T23,T33) (T23,T34) (T23,T35) (T23,T36) (T23,T37) (T23,T38) (T23,T39) (T24,T31) (T24,T32) (T24,T33) (T24,T34) (T24,T35) (T24,T36) (T24,T37) (T24,T38) (T24,T39) (T25,T31) (T25,T32) (T25,T33) (T25,T34) (T25,T35) (T25,T36) (T25,T37) (T25,T38) (T25,T39) (T26,T31) (T26,T32) (T26,T33) (T26,T34) (T26,T35) (T26,T36) (T26,T37) (T26,T38) (T26,T39) (T27,T31) (T27,T32) (T27,T33) (T27,T34) (T27,T35) (T27,T36) (T27,T37) (T27,T38) (T27,T39)
   (T31,D1) (T31,D2) (T31,D3) (T31,D4) (T31,D5) (T31,D6) (T31,D7) (T32,D1) (T32,D2) (T32,D3) (T32,D4) (T32,D5) (T32,D6) (T32,D7) (T33,D1) (T33,D2) (T33,D3) (T33,D4) (T33,D5) (T33,D6) (T33,D7) (T34,D1) (T34,D2) (T34,D3) (T34,D4) (T34,D5) (T34,D6) (T34,D7) (T35,D1) (T35,D2) (T35,D3) (T35,D4) (T35,D5) (T35,D6) (T35,D7) (T36,D1) (T36,D2) (T36,D3) (T36,D4) (T36,D5) (T36,D6) (T36,D7) (T37,D1) (T37,D2) (T37,D3) (T37,D4) (T37,D5) (T37,D6) (T37,D7) (T38,D1) (T38,D2) (T38,D3) (T38,D4) (T38,D5) (T38,D6) (T38,D7) (T39,D1) (T39,D2) (T39,D3) (T39,D4) (T39,D5) (T39,D6) (T39,D7)
   (S1,dummy_dem) (S2,dummy_dem) (S3,dummy_dem) (S4,dummy_dem) (S5,dummy_dem) (S6,dummy_dem) (S7,dummy_dem) (S8,dummy_dem)
   (dummy_sup,D1) (dummy_sup,D2) (dummy_sup,D3) (dummy_sup,D4) (dummy_sup,D5) (dummy_sup,D6) (dummy_sup,D7)
;

param transp_cost := S1 T11 39 S1 T12 71 S1 T13 84 S1 T14 98 S1 T15 71 S1 T16 10 S1 T17 36 S1 T18 71 S1 T19 86 S2 T11 12 S2 T12 79 S2 T13 81 S2 T14 36 S2 T15 18 S2 T16 71 S2 T17 46 S2 T18 60 S2 T19 53 S3 T11 33 S3 T12 88 S3 T13 68 S3 T14 41 S3 T15 97 S3 T16 61 S3 T17 71 S3 T18 67 S3 T19 61 S4 T11 21 S4 T12 48 S4 T13 11 S4 T14 12 S4 T15 65 S4 T16 90 S4 T17 68 S4 T18 11 S4 T19 11 S5 T11 63 S5 T12 96 S5 T13 10 S5 T14 28 S5 T15 11 S5 T16 62 S5 T17 53 S5 T18 99 S5 T19 41 S6 T11 79 S6 T12 41 S6 T13 77 S6 T14 64 S6 T15 84 S6 T16 65 S6 T17 26 S6 T18 47 S6 T19 33 S7 T11 78 S7 T12 79 S7 T13 95 S7 T14 20 S7 T15 25 S7 T16 82 S7 T17 68 S7 T18 79 S7 T19 89 S8 T11 12 S8 T12 29 S8 T13 68 S8 T14 45 S8 T15 28 S8 T16 99 S8 T17 76 S8 T18 28 S8 T19 29 T11 T21 80 T11 T22 61 T11 T23 42 T11 T24 49 T11 T25 48 T11 T26 91 T11 T27 10 T12 T21 20 T12 T22 66 T12 T23 98 T12 T24 59 T12 T25 32 T12 T26 40 T12 T27 51 T13 T21 16 T13 T22 25 T13 T23 99 T13 T24 69 T13 T25 11 T13 T26 10 T13 T27 57 T14 T21 21 T14 T22 78 T14 T23 46 T14 T24 41 T14 T25 18 T14 T26 28 T14 T27 57 T15 T21 89 T15 T22 12 T15 T23 29 T15 T24 33 T15 T25 63 T15 T26 42 T15 T27 33 T16 T21 84 T16 T22 81 T16 T23 45 T16 T24 47 T16 T25 93 T16 T26 98 T16 T27 34 T17 T21 27 T17 T22 91 T17 T23 75 T17 T24 63 T17 T25 44 T17 T26 89 T17 T27 70 T18 T21 50 T18 T22 42 T18 T23 77 T18 T24 42 T18 T25 23 T18 T26 30 T18 T27 57 T19 T21 29 T19 T22 17 T19 T23 16 T19 T24 76 T19 T25 26 T19 T26 42 T19 T27 57 T21 T31 85 T21 T32 68 T21 T33 95 T21 T34 31 T21 T35 39 T21 T36 47 T21 T37 60 T21 T38 63 T21 T39 17 T22 T31 36 T22 T32 36 T22 T33 30 T22 T34 39 T22 T35 37 T22 T36 73 T22 T37 78 T22 T38 70 T22 T39 57 T23 T31 28 T23 T32 13 T23 T33 44 T23 T34 73 T23 T35 58 T23 T36 26 T23 T37 53 T23 T38 39 T23 T39 55 T24 T31 15 T24 T32 46 T24 T33 33 T24 T34 55 T24 T35 62 T24 T36 69 T24 T37 72 T24 T38 94 T24 T39 41 T25 T31 96 T25 T32 42 T25 T33 76 T25 T34 27 T25 T35 34 T25 T36 63 T25 T37 67 T25 T38 76 T25 T39 55 T26 T31 33 T26 T32 41 T26 T33 56 T26 T34 95 T26 T35 32 T26 T36 75 T26 T37 36 T26 T38 11 T26 T39 99 T27 T31 26 T27 T32 42 T27 T33 18 T27 T34 52 T27 T35 57 T27 T36 48 T27 T37 51 T27 T38 35 T27 T39 59 T31 D1 34 T31 D2 33 T31 D3 22 T31 D4 69 T31 D5 16 T31 D6 66 T31 D7 45 T32 D1 54 T32 D2 29 T32 D3 74 T32 D4 17 T32 D5 25 T32 D6 23 T32 D7 85 T33 D1 96 T33 D2 24 T33 D3 75 T33 D4 41 T33 D5 96 T33 D6 72 T33 D7 95 T34 D1 60 T34 D2 34 T34 D3 67 T34 D4 72 T34 D5 71 T34 D6 31 T34 D7 67 T35 D1 67 T35 D2 95 T35 D3 58 T35 D4 61 T35 D5 51 T35 D6 79 T35 D7 24 T36 D1 63 T36 D2 69 T36 D3 17 T36 D4 62 T36 D5 69 T36 D6 14 T36 D7 77 T37 D1 15 T37 D2 56 T37 D3 64 T37 D4 49 T37 D5 61 T37 D6 25 T37 D7 22 T38 D1 39 T38 D2 28 T38 D3 26 T38 D4 72 T38 D5 28 T38 D6 67 T38 D7 64 T39 D1 99 T39 D2 99 T39 D3 71 T39 D4 32 T39 D5 18 T39 D6 21 T39 D7 10;

param supply_demand (tr): S1 S2 S3 S4 S5 S6 S7 S8 T11 T12 T13 T14 T15 T16 T17 T18 T19 T21 T22 T23 T24 T25 T26 T27 T31 T32 T33 T34 T35 T36 T37 T38 T39 D1 D2 D3 D4 D5 D6 D7 dummy_sup dummy_dem := 
    I1 53 64 71 54 57 60 65 76 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -63 -62 -63 -54 -67 -53 -38 0 -100
    I2 49 43 52 52 46 54 40 64 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -91 -98 -72 -92 -93 -86 -68 200 0
    I3 33 38 27 23 35 44 33 67 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -69 -55 -50 -52 -71 -60 -43 100 0
;

param node_capacity := S1 135 S2 145 S3 150 S4 129 S5 138 S6 158 S7 138 S8 207 T11 145 T12 163 T13 147 T14 164 T15 159 T16 145 T17 165 T18 138 T19 301 T21 199 T22 197 T23 205 T24 166 T25 205 T26 217 T27 333 T31 158 T32 158 T33 160 T34 157 T35 151 T36 174 T37 132 T38 162 T39 293 D1 223 D2 215 D3 185 D4 198 D5 231 D6 199 D7 149;

