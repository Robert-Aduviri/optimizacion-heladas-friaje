set S; # suppliers
set K; # plants
set J; # DCs
set I; # customers

param E {S}; # supplier capacity
param D {K}; # plant capacity
param W {J}; # DC capacity
param d {I}; # demand

param P_max; # max open plants
param W_max; # max open DCs
param u; # utilization rate

param g {K}; # plant operation cost
param v {J}; # DC operation cost
param t {S,K}; # supplier-plant purchasing + transportation cost
param a {K,J}; # plant-DC transportation cost
param c {J,I}; # DC-customer transportation cost

var b {S,K} >= 0 integer; # items shipped from supplier to plant
var f {K,J} >= 0 integer; # items shipped from plant to DC
var q {J,I} >= 0 integer; # items shipped from DC to customer

var p {K} binary; # open plants
var z {J} binary; # open DCs
var y {J,I} binary; # DC-customer flag

minimize Cost:
	sum {k in K} g[k] * p[k] + 
	sum {j in J} v[j] * z[j] +
	sum {s in S} sum {k in K} t[s,k] * b[s,k] +
	sum {k in K} sum {j in J} a[k,j] * f[k,j] +
	sum {j in J} sum {i in I} c[j,i] * q[j,i];
	
subject to Customer_Allocation {i in I}:
	sum {j in J} y[j,i] = 1;

subject to DCs_Capacity {j in J}:
	sum {i in I} d[i] * y[j,i] <= W[j] * z[j];

subject to Max_DCs:
	sum {j in J} z[j] <= W_max;
	
subject to DC_Customer_Connection {(j,i) in {J,I}}: 
	q[j,i] = d[i] * y[j,i];
	
subject to Supplier_Plant_Flow_Conservation {k in K}:
	u * sum {j in J} f[k,j] <= sum {s in S} b[s,k];
	
subject to Plant_DC_Flow_Conservation {j in J}:
	sum {k in K} f[k,j] = sum {i in I} q[j,i];
	
subject to Supplier_Capacity {s in S}:
	sum {k in K} b[s,k] <= E[s];
	
subject to Plant_Production_Capacity {k in K}:
	u * sum {j in J} f[k,j] <= D[k] * p[k];
	
subject to Max_Plants:
	sum {k in K} p[k] <= P_max;
	
data;

set S := S1 S2 S3 S4 S5 S6 S7 S8 S9 S10 S11 S12 S13 S14 S15 S16 S17 S18 S19 S20;
set K := K1 K2 K3 K4 K5 K6 K7 K8 K9 K10 K11 K12 K13 K14 K15;
set J := J1 J2 J3 J4 J5 J6 J7 J8 J9 J10 J11 J12;
set I := I1 I2 I3 I4 I5 I6 I7 I8 I9 I10 I11 I12 I13 I14 I15 I16 I17 I18 I19 I20 I21 I22 I23 I24 I25 I26 I27 I28 I29 I30 I31 I32 I33 I34 I35 I36 I37 I38 I39 I40 I41 I42 I43 I44 I45 I46 I47 I48 I49 I50 I51 I52 I53 I54 I55 I56 I57 I58 I59 I60 I61 I62 I63 I64 I65 I66 I67 I68 I69 I70 I71 I72 I73 I74 I75 I76 I77 I78 I79 I80 I81 I82 I83 I84 I85 I86 I87 I88 I89 I90 I91 I92 I93 I94 I95 I96 I97 I98 I99 I100;

param E := S1 760 S2 890 S3 840 S4 800 S5 770 S6 760 S7 880 S8 800 S9 800 S10 730 S11 770 S12 720 S13 710 S14 810 S15 750 S16 710 S17 700 S18 810 S19 810 S20 860;
param D := K1 590 K2 650 K3 640 K4 640 K5 680 K6 610 K7 690 K8 520 K9 540 K10 680 K11 560 K12 580 K13 560 K14 670 K15 530;
param W := J1 430 J2 470 J3 380 J4 310 J5 490 J6 440 J7 360 J8 410 J9 370 J10 440 J11 320 J12 430;
param d := I1 260 I2 130 I3 270 I4 170 I5 130 I6 110 I7 150 I8 190 I9 130 I10 270 I11 210 I12 110 I13 190 I14 130 I15 230 I16 250 I17 240 I18 170 I19 230 I20 170 I21 250 I22 220 I23 270 I24 240 I25 220 I26 180 I27 240 I28 220 I29 100 I30 160 I31 180 I32 100 I33 210 I34 170 I35 200 I36 280 I37 260 I38 170 I39 120 I40 120 I41 100 I42 140 I43 190 I44 160 I45 180 I46 160 I47 180 I48 170 I49 210 I50 110 I51 100 I52 250 I53 140 I54 120 I55 210 I56 170 I57 120 I58 100 I59 120 I60 140 I61 240 I62 230 I63 120 I64 100 I65 140 I66 230 I67 160 I68 180 I69 240 I70 240 I71 190 I72 220 I73 280 I74 160 I75 260 I76 290 I77 130 I78 140 I79 160 I80 220 I81 240 I82 200 I83 130 I84 220 I85 160 I86 280 I87 110 I88 190 I89 220 I90 150 I91 210 I92 210 I93 290 I94 200 I95 160 I96 100 I97 100 I98 290 I99 220 I100 180;

param g := K1 1020 K2 1380 K3 1050 K4 1070 K5 1260 K6 1080 K7 1360 K8 1320 K9 1410 K10 1430 K11 1230 K12 1140 K13 1310 K14 1310 K15 1230;
param v := J1 1400 J2 1480 J3 1480 J4 1110 J5 1380 J6 1010 J7 1020 J8 1480 J9 1360 J10 1480 J11 1160 J12 1480;

param t: K1 K2 K3 K4 K5 K6 K7 K8 K9 K10 K11 K12 K13 K14 K15 :=
      S1 2.0 2.0 6.0 7.0 5.0 1.0 1.0 3.0 2.0 5.0 6.0 7.0 4.0 7.0 8.0
      S2 1.0 6.0 8.0 5.0 4.0 2.0 6.0 6.0 1.0 9.0 6.0 3.0 4.0 4.0 3.0
      S3 3.0 3.0 4.0 7.0 4.0 9.0 1.0 8.0 7.0 2.0 8.0 1.0 9.0 9.0 2.0
      S4 7.0 3.0 7.0 9.0 4.0 1.0 2.0 1.0 5.0 5.0 7.0 9.0 9.0 3.0 3.0
      S5 3.0 4.0 8.0 6.0 8.0 1.0 8.0 4.0 1.0 8.0 4.0 6.0 8.0 4.0 3.0
      S6 9.0 3.0 9.0 2.0 2.0 2.0 6.0 3.0 9.0 4.0 1.0 4.0 1.0 5.0 4.0
      S7 8.0 8.0 7.0 3.0 1.0 1.0 3.0 6.0 7.0 6.0 6.0 6.0 3.0 6.0 8.0
      S8 2.0 5.0 1.0 1.0 5.0 3.0 4.0 3.0 1.0 1.0 5.0 6.0 3.0 9.0 5.0
      S9 8.0 1.0 5.0 3.0 1.0 4.0 5.0 7.0 1.0 3.0 2.0 9.0 6.0 3.0 8.0
      S10 8.0 2.0 6.0 7.0 2.0 2.0 1.0 8.0 1.0 9.0 6.0 7.0 7.0 3.0 2.0
      S11 9.0 8.0 7.0 9.0 4.0 4.0 1.0 8.0 3.0 7.0 2.0 2.0 7.0 6.0 3.0
      S12 9.0 6.0 6.0 1.0 4.0 6.0 6.0 5.0 1.0 8.0 5.0 5.0 7.0 4.0 6.0
      S13 4.0 3.0 7.0 8.0 4.0 2.0 3.0 1.0 8.0 3.0 7.0 5.0 5.0 7.0 9.0
      S14 5.0 1.0 1.0 2.0 6.0 9.0 8.0 5.0 1.0 7.0 5.0 6.0 7.0 3.0 3.0
      S15 5.0 6.0 9.0 5.0 1.0 4.0 5.0 5.0 7.0 4.0 1.0 5.0 7.0 6.0 5.0
      S16 4.0 2.0 4.0 3.0 1.0 8.0 5.0 4.0 8.0 7.0 2.0 1.0 4.0 8.0 2.0
      S17 3.0 1.0 1.0 3.0 5.0 3.0 1.0 1.0 8.0 2.0 3.0 2.0 3.0 7.0 1.0
      S18 8.0 2.0 3.0 9.0 7.0 4.0 5.0 2.0 8.0 4.0 9.0 5.0 9.0 4.0 5.0
      S19 9.0 8.0 3.0 1.0 3.0 4.0 2.0 1.0 7.0 8.0 7.0 5.0 1.0 7.0 7.0
      S20 9.0 3.0 9.0 1.0 1.0 4.0 9.0 6.0 3.0 1.0 4.0 9.0 3.0 9.0 7.0
;

param a: J1 J2 J3 J4 J5 J6 J7 J8 J9 J10 J11 J12 :=
      K1 4.0 3.0 5.0 5.0 3.0 9.0 4.0 5.0 4.0 5.0 7.0 9.0
      K2 7.0 5.0 7.0 5.0 3.0 7.0 2.0 9.0 1.0 6.0 7.0 8.0
      K3 9.0 2.0 2.0 5.0 5.0 6.0 3.0 8.0 1.0 6.0 4.0 1.0
      K4 7.0 9.0 4.0 4.0 6.0 3.0 6.0 7.0 3.0 7.0 3.0 2.0
      K5 4.0 8.0 9.0 7.0 1.0 3.0 9.0 1.0 9.0 8.0 1.0 6.0
      K6 5.0 6.0 5.0 6.0 5.0 5.0 4.0 3.0 3.0 4.0 9.0 2.0
      K7 9.0 1.0 1.0 5.0 6.0 6.0 3.0 7.0 9.0 8.0 6.0 8.0
      K8 5.0 8.0 4.0 8.0 2.0 5.0 9.0 4.0 6.0 1.0 9.0 1.0
      K9 5.0 4.0 3.0 6.0 2.0 3.0 5.0 9.0 2.0 8.0 2.0 5.0
      K10 7.0 8.0 1.0 6.0 1.0 2.0 1.0 5.0 9.0 6.0 1.0 1.0
      K11 2.0 9.0 3.0 1.0 5.0 7.0 6.0 1.0 5.0 5.0 6.0 3.0
      K12 5.0 7.0 5.0 5.0 5.0 3.0 1.0 5.0 9.0 1.0 3.0 4.0
      K13 1.0 1.0 8.0 2.0 8.0 7.0 2.0 6.0 6.0 3.0 2.0 1.0
      K14 6.0 5.0 9.0 1.0 7.0 5.0 5.0 2.0 3.0 7.0 6.0 2.0
      K15 6.0 2.0 2.0 2.0 3.0 2.0 4.0 9.0 6.0 1.0 8.0 7.0
;

param c: I1 I2 I3 I4 I5 I6 I7 I8 I9 I10 I11 I12 I13 I14 I15 I16 I17 I18 I19 I20 I21 I22 I23 I24 I25 I26 I27 I28 I29 I30 I31 I32 I33 I34 I35 I36 I37 I38 I39 I40 I41 I42 I43 I44 I45 I46 I47 I48 I49 I50 I51 I52 I53 I54 I55 I56 I57 I58 I59 I60 I61 I62 I63 I64 I65 I66 I67 I68 I69 I70 I71 I72 I73 I74 I75 I76 I77 I78 I79 I80 I81 I82 I83 I84 I85 I86 I87 I88 I89 I90 I91 I92 I93 I94 I95 I96 I97 I98 I99 I100 :=
      J1 3.0 1.0 5.0 4.0 8.0 1.0 1.0 4.0 8.0 5.0 2.0 6.0 5.0 2.0 3.0 9.0 7.0 7.0 6.0 8.0 4.0 8.0 4.0 8.0 9.0 3.0 3.0 2.0 3.0 3.0 5.0 5.0 2.0 6.0 5.0 6.0 1.0 5.0 9.0 2.0 1.0 9.0 9.0 9.0 6.0 8.0 1.0 4.0 1.0 8.0 1.0 3.0 4.0 8.0 6.0 7.0 8.0 2.0 8.0 3.0 7.0 3.0 7.0 2.0 6.0 3.0 3.0 9.0 7.0 5.0 7.0 9.0 1.0 7.0 6.0 9.0 1.0 4.0 9.0 4.0 3.0 9.0 2.0 4.0 6.0 2.0 8.0 8.0 1.0 3.0 9.0 5.0 6.0 4.0 2.0 8.0 6.0 5.0 9.0 1.0
      J2 5.0 6.0 5.0 6.0 6.0 7.0 4.0 8.0 7.0 9.0 7.0 3.0 3.0 8.0 5.0 4.0 8.0 6.0 2.0 4.0 4.0 6.0 6.0 1.0 8.0 6.0 3.0 9.0 2.0 8.0 3.0 5.0 6.0 6.0 4.0 3.0 4.0 1.0 4.0 1.0 1.0 6.0 5.0 4.0 3.0 1.0 6.0 2.0 8.0 5.0 7.0 2.0 8.0 2.0 4.0 1.0 5.0 9.0 1.0 9.0 8.0 6.0 7.0 3.0 1.0 5.0 2.0 5.0 8.0 9.0 2.0 3.0 3.0 1.0 8.0 6.0 8.0 9.0 5.0 3.0 5.0 5.0 5.0 3.0 4.0 9.0 9.0 2.0 8.0 8.0 7.0 8.0 3.0 6.0 1.0 7.0 1.0 9.0 1.0 1.0
      J3 7.0 2.0 5.0 8.0 8.0 3.0 7.0 3.0 6.0 6.0 3.0 7.0 3.0 8.0 4.0 1.0 4.0 7.0 4.0 6.0 9.0 1.0 5.0 7.0 1.0 4.0 6.0 2.0 5.0 1.0 6.0 6.0 4.0 8.0 4.0 8.0 8.0 5.0 4.0 2.0 3.0 3.0 4.0 4.0 5.0 4.0 8.0 6.0 6.0 8.0 7.0 8.0 2.0 9.0 1.0 8.0 4.0 4.0 5.0 8.0 5.0 8.0 1.0 9.0 6.0 3.0 8.0 9.0 6.0 7.0 1.0 5.0 5.0 4.0 6.0 7.0 9.0 1.0 6.0 7.0 3.0 8.0 5.0 9.0 5.0 9.0 4.0 9.0 5.0 9.0 3.0 4.0 9.0 6.0 2.0 7.0 2.0 2.0 1.0 3.0
      J4 6.0 8.0 9.0 7.0 4.0 6.0 5.0 8.0 1.0 1.0 6.0 2.0 5.0 1.0 7.0 1.0 4.0 9.0 1.0 4.0 6.0 6.0 8.0 1.0 7.0 1.0 7.0 3.0 8.0 3.0 1.0 8.0 3.0 2.0 1.0 3.0 2.0 2.0 6.0 1.0 2.0 6.0 3.0 4.0 1.0 8.0 7.0 7.0 3.0 3.0 2.0 1.0 7.0 7.0 2.0 7.0 8.0 1.0 9.0 7.0 3.0 8.0 7.0 8.0 6.0 9.0 5.0 3.0 3.0 1.0 8.0 2.0 3.0 8.0 8.0 4.0 4.0 5.0 6.0 5.0 7.0 2.0 7.0 7.0 1.0 7.0 5.0 3.0 3.0 4.0 2.0 2.0 1.0 5.0 4.0 2.0 3.0 7.0 7.0 4.0
      J5 5.0 5.0 6.0 9.0 2.0 5.0 3.0 4.0 6.0 8.0 1.0 8.0 7.0 1.0 2.0 3.0 1.0 9.0 8.0 2.0 9.0 7.0 9.0 6.0 6.0 4.0 2.0 7.0 5.0 6.0 2.0 5.0 4.0 9.0 6.0 2.0 1.0 5.0 9.0 6.0 7.0 5.0 6.0 5.0 9.0 6.0 8.0 2.0 9.0 5.0 7.0 1.0 5.0 2.0 6.0 1.0 3.0 5.0 4.0 3.0 5.0 8.0 4.0 1.0 7.0 8.0 3.0 6.0 2.0 7.0 8.0 6.0 6.0 5.0 8.0 1.0 4.0 4.0 3.0 3.0 4.0 1.0 2.0 9.0 2.0 5.0 9.0 9.0 8.0 1.0 1.0 9.0 8.0 9.0 7.0 3.0 3.0 2.0 5.0 3.0
      J6 6.0 2.0 3.0 5.0 1.0 1.0 9.0 7.0 1.0 8.0 3.0 8.0 5.0 1.0 7.0 5.0 6.0 6.0 8.0 9.0 2.0 9.0 9.0 7.0 1.0 7.0 5.0 6.0 7.0 5.0 7.0 9.0 3.0 8.0 2.0 7.0 2.0 4.0 7.0 3.0 2.0 7.0 1.0 8.0 3.0 2.0 3.0 5.0 8.0 7.0 7.0 7.0 8.0 1.0 4.0 6.0 9.0 2.0 1.0 2.0 7.0 3.0 2.0 7.0 2.0 3.0 7.0 4.0 1.0 5.0 9.0 8.0 9.0 9.0 7.0 4.0 5.0 1.0 1.0 3.0 8.0 2.0 4.0 2.0 5.0 9.0 1.0 5.0 9.0 1.0 9.0 8.0 4.0 5.0 5.0 6.0 7.0 8.0 8.0 2.0
      J7 9.0 7.0 4.0 4.0 8.0 4.0 6.0 5.0 3.0 2.0 9.0 9.0 1.0 3.0 8.0 6.0 5.0 5.0 6.0 7.0 1.0 9.0 3.0 4.0 1.0 3.0 2.0 2.0 1.0 8.0 3.0 3.0 6.0 8.0 9.0 9.0 4.0 5.0 2.0 9.0 8.0 3.0 9.0 3.0 9.0 2.0 9.0 8.0 9.0 5.0 2.0 8.0 6.0 8.0 5.0 2.0 6.0 5.0 5.0 1.0 2.0 8.0 3.0 3.0 8.0 8.0 2.0 8.0 1.0 6.0 8.0 3.0 8.0 1.0 9.0 9.0 5.0 4.0 6.0 7.0 5.0 9.0 3.0 7.0 5.0 7.0 2.0 4.0 2.0 7.0 2.0 1.0 9.0 1.0 8.0 2.0 8.0 3.0 6.0 3.0
      J8 7.0 9.0 2.0 5.0 6.0 4.0 4.0 4.0 2.0 4.0 1.0 6.0 1.0 6.0 1.0 6.0 8.0 2.0 2.0 4.0 3.0 4.0 7.0 1.0 6.0 3.0 7.0 2.0 2.0 4.0 1.0 3.0 9.0 7.0 7.0 4.0 2.0 4.0 6.0 3.0 1.0 8.0 5.0 5.0 4.0 6.0 3.0 9.0 5.0 3.0 1.0 6.0 2.0 3.0 1.0 9.0 8.0 2.0 8.0 9.0 1.0 5.0 8.0 2.0 4.0 7.0 3.0 5.0 8.0 3.0 4.0 9.0 7.0 1.0 4.0 4.0 9.0 6.0 9.0 6.0 6.0 5.0 5.0 2.0 8.0 8.0 1.0 8.0 5.0 2.0 2.0 6.0 9.0 1.0 6.0 9.0 8.0 6.0 3.0 8.0
      J9 9.0 1.0 9.0 6.0 6.0 4.0 1.0 8.0 2.0 1.0 2.0 1.0 1.0 9.0 1.0 4.0 6.0 7.0 2.0 6.0 7.0 2.0 2.0 7.0 1.0 8.0 3.0 6.0 9.0 6.0 9.0 7.0 9.0 2.0 8.0 8.0 2.0 4.0 7.0 4.0 4.0 6.0 6.0 3.0 9.0 2.0 6.0 7.0 9.0 3.0 3.0 7.0 4.0 8.0 7.0 5.0 7.0 3.0 2.0 6.0 2.0 3.0 6.0 5.0 8.0 9.0 3.0 3.0 3.0 6.0 1.0 7.0 1.0 5.0 8.0 4.0 5.0 4.0 4.0 8.0 2.0 1.0 3.0 9.0 4.0 5.0 2.0 4.0 2.0 2.0 4.0 6.0 7.0 3.0 3.0 6.0 3.0 2.0 8.0 5.0
      J10 1.0 3.0 8.0 4.0 7.0 2.0 7.0 5.0 5.0 6.0 9.0 6.0 8.0 7.0 9.0 4.0 2.0 7.0 6.0 1.0 9.0 9.0 2.0 3.0 5.0 5.0 1.0 8.0 8.0 4.0 7.0 3.0 6.0 9.0 1.0 5.0 4.0 8.0 1.0 9.0 6.0 4.0 9.0 5.0 5.0 5.0 1.0 1.0 8.0 8.0 6.0 4.0 2.0 2.0 9.0 5.0 4.0 1.0 7.0 3.0 6.0 5.0 5.0 5.0 1.0 1.0 3.0 4.0 5.0 2.0 8.0 2.0 9.0 2.0 9.0 7.0 8.0 2.0 7.0 6.0 4.0 7.0 4.0 2.0 7.0 8.0 2.0 5.0 1.0 7.0 8.0 6.0 5.0 6.0 2.0 1.0 7.0 7.0 2.0 2.0
      J11 1.0 8.0 8.0 1.0 8.0 9.0 4.0 1.0 1.0 3.0 5.0 5.0 9.0 2.0 2.0 6.0 9.0 1.0 9.0 9.0 9.0 5.0 9.0 4.0 2.0 6.0 4.0 6.0 3.0 6.0 2.0 2.0 9.0 7.0 3.0 1.0 8.0 6.0 7.0 9.0 5.0 1.0 7.0 5.0 3.0 9.0 1.0 1.0 1.0 3.0 6.0 3.0 8.0 2.0 9.0 3.0 5.0 8.0 2.0 6.0 5.0 9.0 5.0 2.0 5.0 4.0 7.0 6.0 2.0 5.0 7.0 7.0 5.0 9.0 4.0 3.0 4.0 5.0 6.0 3.0 2.0 4.0 5.0 4.0 3.0 8.0 4.0 2.0 2.0 1.0 4.0 9.0 7.0 7.0 7.0 8.0 1.0 8.0 4.0 4.0
      J12 4.0 6.0 7.0 6.0 1.0 8.0 7.0 6.0 6.0 5.0 6.0 9.0 9.0 8.0 9.0 8.0 8.0 1.0 5.0 4.0 2.0 8.0 3.0 4.0 7.0 9.0 2.0 3.0 4.0 1.0 7.0 2.0 5.0 1.0 3.0 2.0 1.0 7.0 5.0 1.0 6.0 5.0 3.0 7.0 9.0 9.0 9.0 2.0 3.0 7.0 5.0 2.0 3.0 6.0 7.0 9.0 1.0 7.0 8.0 3.0 4.0 6.0 7.0 4.0 8.0 5.0 1.0 4.0 3.0 9.0 8.0 1.0 6.0 9.0 7.0 4.0 1.0 2.0 5.0 5.0 8.0 6.0 8.0 2.0 3.0 6.0 3.0 6.0 6.0 2.0 7.0 2.0 6.0 1.0 3.0 2.0 7.0 4.0 8.0 6.0
;

param P_max := 15;
param W_max := 12;
param u := 1;
