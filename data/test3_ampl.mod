set S; # suppliers
set K; # plants
set J; # DCs
set I; # customers

param E {S}; # supplier capacity
param D {K}; # plant capacity
param W {J}; # DC capacity
param d {I}; # demand

param P_max; # max open plants
param W_max; # max open DCs
param u; # utilization rate

param g {K}; # plant operation cost
param v {J}; # DC operation cost
param t {S,K}; # supplier-plant purchasing + transportation cost
param a {K,J}; # plant-DC transportation cost
param c {J,I}; # DC-customer transportation cost

var b {S,K} >= 0 integer; # items shipped from supplier to plant
var f {K,J} >= 0 integer; # items shipped from plant to DC
var q {J,I} >= 0 integer; # items shipped from DC to customer

var p {K} binary; # open plants
var z {J} binary; # open DCs
var y {J,I} binary; # DC-customer flag

minimize Cost:
	sum {k in K} g[k] * p[k] + 
	sum {j in J} v[j] * z[j] +
	sum {s in S} sum {k in K} t[s,k] * b[s,k] +
	sum {k in K} sum {j in J} a[k,j] * f[k,j] +
	sum {j in J} sum {i in I} c[j,i] * q[j,i];
	
subject to Customer_Allocation {i in I}:
	sum {j in J} y[j,i] = 1;

subject to DCs_Capacity {j in J}:
	sum {i in I} d[i] * y[j,i] <= W[j] * z[j];

subject to Max_DCs:
	sum {j in J} z[j] <= W_max;
	
subject to DC_Customer_Connection {(j,i) in {J,I}}: 
	q[j,i] = d[i] * y[j,i];
	
subject to Supplier_Plant_Flow_Conservation {k in K}:
	u * sum {j in J} f[k,j] <= sum {s in S} b[s,k];
	
subject to Plant_DC_Flow_Conservation {j in J}:
	sum {k in K} f[k,j] = sum {i in I} q[j,i];
	
subject to Supplier_Capacity {s in S}:
	sum {k in K} b[s,k] <= E[s];
	
subject to Plant_Production_Capacity {k in K}:
	u * sum {j in J} f[k,j] <= D[k] * p[k];
	
subject to Max_Plants:
	sum {k in K} p[k] <= P_max;
	
data;

set S := S1 S2 S3 S4 S5 S6 S7 S8 S9 S10;
set K := K1 K2 K3 K4 K5 K6;
set J := J1 J2 J3 J4 J5 J6 J7 J8;
set I := I1 I2 I3 I4 I5 I6 I7 I8 I9 I10 I11 I12 I13 I14 I15 I16 I17 I18 I19 I20 I21 I22 I23 I24 I25 I26 I27 I28 I29 I30 I31 I32 I33 I34 I35 I36 I37 I38 I39 I40 I41 I42 I43 I44 I45 I46 I47 I48 I49 I50 I51 I52 I53 I54 I55 I56 I57 I58 I59 I60 I61 I62 I63 I64 I65 I66 I67 I68 I69 I70 I71 I72 I73 I74 I75 I76 I77 I78 I79 I80 I81 I82 I83 I84 I85 I86 I87 I88 I89 I90 I91 I92 I93 I94 I95 I96 I97 I98 I99 I100;

param E := S1 760 S2 890 S3 840 S4 800 S5 770 S6 760 S7 880 S8 800 S9 800 S10 730;
param D := K1 570 K2 520 K3 510 K4 610 K5 550 K6 510;
param W := J1 300 J2 410 J3 410 J4 460 J5 390 J6 450 J7 440 J8 440;
param d := I1 280 I2 210 I3 290 I4 120 I5 140 I6 280 I7 160 I8 180 I9 160 I10 270 I11 130 I12 230 I13 270 I14 180 I15 110 I16 290 I17 240 I18 160 I19 210 I20 170 I21 240 I22 120 I23 230 I24 260 I25 130 I26 270 I27 170 I28 130 I29 110 I30 150 I31 190 I32 130 I33 270 I34 210 I35 110 I36 190 I37 130 I38 230 I39 250 I40 240 I41 170 I42 230 I43 170 I44 250 I45 220 I46 270 I47 240 I48 220 I49 180 I50 240 I51 220 I52 100 I53 160 I54 180 I55 100 I56 210 I57 170 I58 200 I59 280 I60 260 I61 170 I62 120 I63 120 I64 100 I65 140 I66 190 I67 160 I68 180 I69 160 I70 180 I71 170 I72 210 I73 110 I74 100 I75 250 I76 140 I77 120 I78 210 I79 170 I80 120 I81 100 I82 120 I83 140 I84 240 I85 230 I86 120 I87 100 I88 140 I89 230 I90 160 I91 180 I92 240 I93 240 I94 190 I95 220 I96 280 I97 160 I98 260 I99 290 I100 130;

param g := K1 1290 K2 1360 K3 1220 K4 1380 K5 1440 K6 1140;
param v := J1 1420 J2 1280 J3 1350 J4 1120 J5 1310 J6 1060 J7 1210 J8 1270;

param t: K1 K2 K3 K4 K5 K6 :=
      S1 2.0 9.0 5.0 6.0 4.0 7.0
      S2 9.0 7.0 1.0 1.0 9.0 9.0
      S3 4.0 9.0 3.0 7.0 6.0 8.0
      S4 9.0 5.0 1.0 3.0 8.0 6.0
      S5 8.0 9.0 4.0 1.0 1.0 4.0
      S6 7.0 2.0 3.0 1.0 5.0 1.0
      S7 8.0 1.0 1.0 2.0 2.0 6.0
      S8 7.0 5.0 1.0 1.0 3.0 2.0
      S9 5.0 6.0 7.0 4.0 7.0 8.0
      S10 1.0 6.0 8.0 5.0 4.0 2.0
;

param a: J1 J2 J3 J4 J5 J6 J7 J8 :=
      K1 6.0 6.0 1.0 9.0 6.0 3.0 4.0 4.0
      K2 3.0 3.0 3.0 4.0 7.0 4.0 9.0 1.0
      K3 8.0 7.0 2.0 8.0 1.0 9.0 9.0 2.0
      K4 7.0 3.0 7.0 9.0 4.0 1.0 2.0 1.0
      K5 5.0 5.0 7.0 9.0 9.0 3.0 3.0 3.0
      K6 4.0 8.0 6.0 8.0 1.0 8.0 4.0 1.0
;

param c: I1 I2 I3 I4 I5 I6 I7 I8 I9 I10 I11 I12 I13 I14 I15 I16 I17 I18 I19 I20 I21 I22 I23 I24 I25 I26 I27 I28 I29 I30 I31 I32 I33 I34 I35 I36 I37 I38 I39 I40 I41 I42 I43 I44 I45 I46 I47 I48 I49 I50 I51 I52 I53 I54 I55 I56 I57 I58 I59 I60 I61 I62 I63 I64 I65 I66 I67 I68 I69 I70 I71 I72 I73 I74 I75 I76 I77 I78 I79 I80 I81 I82 I83 I84 I85 I86 I87 I88 I89 I90 I91 I92 I93 I94 I95 I96 I97 I98 I99 I100 :=
      J1 8.0 4.0 6.0 8.0 4.0 3.0 9.0 3.0 9.0 2.0 2.0 2.0 6.0 3.0 9.0 4.0 1.0 4.0 1.0 5.0 4.0 8.0 8.0 7.0 3.0 1.0 1.0 3.0 6.0 7.0 6.0 6.0 6.0 3.0 6.0 8.0 2.0 5.0 1.0 1.0 5.0 3.0 4.0 3.0 1.0 1.0 5.0 6.0 3.0 9.0 5.0 8.0 1.0 5.0 3.0 1.0 4.0 5.0 7.0 1.0 3.0 2.0 9.0 6.0 3.0 8.0 8.0 2.0 6.0 7.0 2.0 2.0 1.0 8.0 1.0 9.0 6.0 7.0 7.0 3.0 2.0 9.0 8.0 7.0 9.0 4.0 4.0 1.0 8.0 3.0 7.0 2.0 2.0 7.0 6.0 3.0 9.0 6.0 6.0 1.0
      J2 4.0 6.0 6.0 5.0 1.0 8.0 5.0 5.0 7.0 4.0 6.0 4.0 3.0 7.0 8.0 4.0 2.0 3.0 1.0 8.0 3.0 7.0 5.0 5.0 7.0 9.0 5.0 1.0 1.0 2.0 6.0 9.0 8.0 5.0 1.0 7.0 5.0 6.0 7.0 3.0 3.0 5.0 6.0 9.0 5.0 1.0 4.0 5.0 5.0 7.0 4.0 1.0 5.0 7.0 6.0 5.0 4.0 2.0 4.0 3.0 1.0 8.0 5.0 4.0 8.0 7.0 2.0 1.0 4.0 8.0 2.0 3.0 1.0 1.0 3.0 5.0 3.0 1.0 1.0 8.0 2.0 3.0 2.0 3.0 7.0 1.0 8.0 2.0 3.0 9.0 7.0 4.0 5.0 2.0 8.0 4.0 9.0 5.0 9.0 4.0
      J3 5.0 9.0 8.0 3.0 1.0 3.0 4.0 2.0 1.0 7.0 8.0 7.0 5.0 1.0 7.0 7.0 9.0 3.0 9.0 1.0 1.0 4.0 9.0 6.0 3.0 1.0 4.0 9.0 3.0 9.0 7.0 4.0 3.0 5.0 5.0 3.0 9.0 4.0 5.0 4.0 5.0 7.0 9.0 7.0 5.0 7.0 5.0 3.0 7.0 2.0 9.0 1.0 6.0 7.0 8.0 9.0 2.0 2.0 5.0 5.0 6.0 3.0 8.0 1.0 6.0 4.0 1.0 7.0 9.0 4.0 4.0 6.0 3.0 6.0 7.0 3.0 7.0 3.0 2.0 4.0 8.0 9.0 7.0 1.0 3.0 9.0 1.0 9.0 8.0 1.0 6.0 5.0 6.0 5.0 6.0 5.0 5.0 4.0 3.0 3.0
      J4 4.0 9.0 2.0 9.0 1.0 1.0 5.0 6.0 6.0 3.0 7.0 9.0 8.0 6.0 8.0 5.0 8.0 4.0 8.0 2.0 5.0 9.0 4.0 6.0 1.0 9.0 1.0 5.0 4.0 3.0 6.0 2.0 3.0 5.0 9.0 2.0 8.0 2.0 5.0 7.0 8.0 1.0 6.0 1.0 2.0 1.0 5.0 9.0 6.0 1.0 1.0 2.0 9.0 3.0 1.0 5.0 7.0 6.0 1.0 5.0 5.0 6.0 3.0 5.0 7.0 5.0 5.0 5.0 3.0 1.0 5.0 9.0 1.0 3.0 4.0 1.0 1.0 8.0 2.0 8.0 7.0 2.0 6.0 6.0 3.0 2.0 1.0 6.0 5.0 9.0 1.0 7.0 5.0 5.0 2.0 3.0 7.0 6.0 2.0 6.0
      J5 2.0 2.0 2.0 3.0 2.0 4.0 9.0 6.0 1.0 8.0 7.0 3.0 1.0 5.0 4.0 8.0 1.0 1.0 4.0 8.0 5.0 2.0 6.0 5.0 2.0 3.0 9.0 7.0 7.0 6.0 8.0 4.0 8.0 4.0 8.0 9.0 3.0 3.0 2.0 3.0 3.0 5.0 5.0 2.0 6.0 5.0 6.0 1.0 5.0 9.0 2.0 1.0 9.0 9.0 9.0 6.0 8.0 1.0 4.0 1.0 8.0 1.0 3.0 4.0 8.0 6.0 7.0 8.0 2.0 8.0 3.0 7.0 3.0 7.0 2.0 6.0 3.0 3.0 9.0 7.0 5.0 7.0 9.0 1.0 7.0 6.0 9.0 1.0 4.0 9.0 4.0 3.0 9.0 2.0 4.0 6.0 2.0 8.0 8.0 1.0
      J6 3.0 9.0 5.0 6.0 4.0 2.0 8.0 6.0 5.0 9.0 1.0 5.0 6.0 5.0 6.0 6.0 7.0 4.0 8.0 7.0 9.0 7.0 3.0 3.0 8.0 5.0 4.0 8.0 6.0 2.0 4.0 4.0 6.0 6.0 1.0 8.0 6.0 3.0 9.0 2.0 8.0 3.0 5.0 6.0 6.0 4.0 3.0 4.0 1.0 4.0 1.0 1.0 6.0 5.0 4.0 3.0 1.0 6.0 2.0 8.0 5.0 7.0 2.0 8.0 2.0 4.0 1.0 5.0 9.0 1.0 9.0 8.0 6.0 7.0 3.0 1.0 5.0 2.0 5.0 8.0 9.0 2.0 3.0 3.0 1.0 8.0 6.0 8.0 9.0 5.0 3.0 5.0 5.0 5.0 3.0 4.0 9.0 9.0 2.0 8.0
      J7 8.0 7.0 8.0 3.0 6.0 1.0 7.0 1.0 9.0 1.0 1.0 7.0 2.0 5.0 8.0 8.0 3.0 7.0 3.0 6.0 6.0 3.0 7.0 3.0 8.0 4.0 1.0 4.0 7.0 4.0 6.0 9.0 1.0 5.0 7.0 1.0 4.0 6.0 2.0 5.0 1.0 6.0 6.0 4.0 8.0 4.0 8.0 8.0 5.0 4.0 2.0 3.0 3.0 4.0 4.0 5.0 4.0 8.0 6.0 6.0 8.0 7.0 8.0 2.0 9.0 1.0 8.0 4.0 4.0 5.0 8.0 5.0 8.0 1.0 9.0 6.0 3.0 8.0 9.0 6.0 7.0 1.0 5.0 5.0 4.0 6.0 7.0 9.0 1.0 6.0 7.0 3.0 8.0 5.0 9.0 5.0 9.0 4.0 9.0 5.0
      J8 9.0 3.0 4.0 9.0 6.0 2.0 7.0 2.0 2.0 1.0 3.0 6.0 8.0 9.0 7.0 4.0 6.0 5.0 8.0 1.0 1.0 6.0 2.0 5.0 1.0 7.0 1.0 4.0 9.0 1.0 4.0 6.0 6.0 8.0 1.0 7.0 1.0 7.0 3.0 8.0 3.0 1.0 8.0 3.0 2.0 1.0 3.0 2.0 2.0 6.0 1.0 2.0 6.0 3.0 4.0 1.0 8.0 7.0 7.0 3.0 3.0 2.0 1.0 7.0 7.0 2.0 7.0 8.0 1.0 9.0 7.0 3.0 8.0 7.0 8.0 6.0 9.0 5.0 3.0 3.0 1.0 8.0 2.0 3.0 8.0 8.0 4.0 4.0 5.0 6.0 5.0 7.0 2.0 7.0 7.0 1.0 7.0 5.0 3.0 3.0
;

param P_max := 6;
param W_max := 8;
param u := 1;
